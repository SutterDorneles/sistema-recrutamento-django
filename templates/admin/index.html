{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
    {{ block.super }}
    <style>
        /* Estilos para os cartões de estatísticas do Jazzmin */
        .small-box {
            border-radius: .25rem;
            box-shadow: 0 0 1px rgba(0,0,0,.125),0 1px 3px rgba(0,0,0,.2);
            display: block;
            margin-bottom: 20px;
            position: relative;
        }
        .small-box > .inner {
            padding: 10px;
        }
        .small-box h3, .small-box p {
            z-index: 5;
            color: #fff;
        }
        .small-box h3 {
            font-size: 38px;
            font-weight: 700;
            margin: 0 0 10px 0;
            padding: 0;
            white-space: nowrap;
        }
        .small-box .icon {
            color: rgba(0,0,0,.15);
            z-index: 0;
            font-size: 70px;
            position: absolute;
            right: 15px;
            top: 15px;
            transition: all .3s linear;
        }
        .small-box:hover .icon {
            font-size: 75px;
        }
        .bg-info { background-color: #17a2b8 !important; }
        .bg-success { background-color: #28a745 !important; }
        .bg-warning { background-color: #ffc107 !important; color: #1f2d3d !important; }
        .bg-purple { background-color: #6f42c1 !important; }
        .bg-orange { background-color: #fd7e14 !important; }
        .bg-teal { background-color: #20c997 !important; }
        .bg-dark { background-color: #343a40 !important; }

        /* Correção para o contentor do gráfico */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .card-body.p-0 .table th, .card-body.p-0 .table td {
            padding: .75rem;
        }
    </style>
{% endblock %}

{% block content_title %}
    <h1>Dashboard de Recrutamento</h1>
{% endblock %}

{% block content %}
<!-- CORREÇÃO: Agrupados todos os cartões de estatísticas numa única linha para melhor espaçamento -->
<div class="row">
    <!-- Cartão Pipeline -->
    <div class="col-lg-3 col-md-6 col-12">
        <a href="{% url 'admin:pipeline' %}" style="text-decoration: none;">
            <div class="small-box bg-purple">
                <div class="inner"><h3>Pipeline</h3><p>Visualizar Funil</p></div>
                <div class="icon"><i class="fas fa-stream"></i></div>
            </div>
        </a>
    </div>
    <!-- Cartão Vagas Ativas -->
    <div class="col-lg-3 col-md-6 col-12">
        <a href="{{ url_vagas }}" style="text-decoration: none;">
            <div class="small-box bg-info">
                <div class="inner"><h3>{{ total_vagas }}</h3><p>Vagas Ativas</p></div>
                <div class="icon"><i class="fas fa-briefcase"></i></div>
            </div>
        </a>
    </div>
    <!-- Cartão Novas Inscrições -->
    <div class="col-lg-3 col-md-6 col-12">
        <div class="small-box bg-success">
            <div class="inner"><h3>{{ novas_inscricoes }}</h3><p>Novas Inscrições (7 dias)</p></div>
            <div class="icon"><i class="fas fa-user-plus"></i></div>
        </div>
    </div>
    <!-- Cartão Em Análise -->
    <div class="col-lg-3 col-md-6 col-12">
        <a href="{{ url_em_analise }}" style="text-decoration: none;">
            <div class="small-box bg-warning">
                <div class="inner"><h3>{{ candidatos_em_analise }}</h3><p>Candidatos em Análise</p></div>
                <div class="icon"><i class="fas fa-search"></i></div>
            </div>
        </a>
    </div>
    <!-- Cartão Em Entrevista -->
    <div class="col-lg-3 col-md-6 col-12">
        <a href="{{ url_entrevista }}" style="text-decoration: none;">
            <div class="small-box bg-orange">
                <div class="inner"><h3>{{ candidatos_entrevista }}</h3><p>Em Entrevista</p></div>
                <div class="icon"><i class="fas fa-comments"></i></div>
            </div>
        </a>
    </div>
    <!-- Cartão Aprovados -->
    <div class="col-lg-3 col-md-6 col-12">
        <a href="{{ url_aprovados }}" style="text-decoration: none;">
            <div class="small-box bg-teal">
                <div class="inner"><h3>{{ candidatos_aprovados }}</h3><p>Aprovados</p></div>
                <div class="icon"><i class="fas fa-check-circle"></i></div>
            </div>
        </a>
    </div>
    <!-- Cartão Rejeitados -->
    <div class="col-lg-3 col-md-6 col-12">
        <a href="{{ url_rejeitados }}" style="text-decoration: none;">
            <div class="small-box bg-dark">
                <div class="inner"><h3>{{ candidatos_rejeitados }}</h3><p>Rejeitados</p></div>
                <div class="icon"><i class="fas fa-times-circle"></i></div>
            </div>
        </a>
    </div>
</div>

<div class="row">
    <!-- Gráfico de Perfis -->
    <div class="col-lg-7">
        <div class="card card-primary card-outline">
            <div class="card-header"><h3 class="card-title"><i class="far fa-chart-bar"></i> Distribuição de Perfis Comportamentais</h3></div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="perfilChart" 
                            data-aguia="{{ total_aguia|default:0 }}"
                            data-gato="{{ total_gato|default:0 }}"
                            data-tubarao="{{ total_tubarao|default:0 }}"
                            data-lobo="{{ total_lobo|default:0 }}">
                    </canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Lista de Acesso Rápido -->
    <div class="col-lg-5">
        <div class="card card-primary card-outline">
            <div class="card-header"><h3 class="card-title"><i class="fas fa-tasks"></i> Acesso Rápido</h3></div>
            <div class="card-body p-0">
                {% for app in app_list %}
                    <table class="table table-striped">
                        {% for model in app.models %}
                            <tr>
                                {% if model.admin_url %}
                                    <td><a href="{{ model.admin_url }}">{{ model.name }}</a></td>
                                {% else %}
                                    <td>{{ model.name }}</td>
                                {% endif %}
                                {% if model.add_url %}
                                    <td class="text-right"><a href="{{ model.add_url }}" class="addlink">Adicionar</a></td>
                                {% else %}
                                    <td>&nbsp;</td>
                                {% endif %}
                            </tr>
                        {% endfor %}
                    </table>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const chartCanvas = document.getElementById('perfilChart');
        if (chartCanvas) {
            const ctx = chartCanvas.getContext('2d');
            const chartData = [
                chartCanvas.dataset.aguia,
                chartCanvas.dataset.gato,
                chartCanvas.dataset.tubarao,
                chartCanvas.dataset.lobo
            ];

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Águia (I)', 'Gato (C)', 'Tubarão (A)', 'Lobo (O)'],
                    datasets: [{
                        label: 'Total de Candidatos',
                        data: chartData,
                        backgroundColor: ['rgba(54, 162, 235, 0.7)', 'rgba(255, 206, 86, 0.7)', 'rgba(255, 99, 132, 0.7)', 'rgba(75, 192, 192, 0.7)'],
                        borderColor: ['rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)', 'rgba(255, 99, 132, 1)', 'rgba(75, 192, 192, 1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
    });
</script>
{% endblock %}
