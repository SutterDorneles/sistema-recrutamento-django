{% extends "admin/change_form.html" %}
{% load static %}

{% block field_sets %}
    {{ block.super }}

    {% if chart_data %}
    <fieldset class="module aligned">
        <h2>Resultado do Teste de Perfil</h2>
        <div class="form-row">
            <div style="width: 100%; max-width: 800px; margin: 0 auto;">
                <h4>Perfil Predominante: <strong>{{ chart_data.perfil_principal|default:"Não calculado" }}</strong></h4>
                
                <!-- Percentuais detalhados por escrito -->
                <div style="margin-top: 15px; padding: 10px; background-color: #f7f7f9; border-radius: 4px;">
                    <p><strong>Percentuais detalhados:</strong></p>
                    <ul style="list-style-type: none; padding-left: 0;">
                        <li>- Águia (Idealizador): <strong>{{ chart_data.aguia }}%</strong></li>
                        <li>- Gato (Comunicador): <strong>{{ chart_data.gato }}%</strong></li>
                        <li>- Tubarão (Executor): <strong>{{ chart_data.tubarao }}%</strong></li>
                        <li>- Lobo (Analista): <strong>{{ chart_data.lobo }}%</strong></li>
                    </ul>
                </div>

                <!-- CORREÇÃO: Tamanho definido diretamente no canvas, como você sugeriu -->
                <div style="margin-top: 20px;">
                    <canvas id="radarChart" width="800" height="450"
                            data-aguia="{{ chart_data.aguia|default:0 }}"
                            data-gato="{{ chart_data.gato|default:0 }}"
                            data-tubarao="{{ chart_data.tubarao|default:0 }}"
                            data-lobo="{{ chart_data.lobo|default:0 }}">
                    </canvas>
                </div>
            </div>
        </div>
    </fieldset>
    {% endif %}
{% endblock %}

{% block admin_change_form_document_ready %}
    {{ block.super }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chartCanvas = document.getElementById('radarChart');
            if (chartCanvas && typeof Chart !== 'undefined') {
                const ctx = chartCanvas.getContext('2d');

                const chartData = [
                    chartCanvas.dataset.aguia,
                    chartCanvas.dataset.gato,
                    chartCanvas.dataset.tubarao,
                    chartCanvas.dataset.lobo
                ];

                new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: [
                            'Águia (Idealizador)',
                            'Gato (Comunicador)',
                            'Tubarão (Executor)',
                            'Lobo (Analista)'
                        ],
                        datasets: [{
                            label: 'Percentual de Perfil (%)',
                            data: chartData,
                            fill: true,
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgb(54, 162, 235)',
                            pointBackgroundColor: 'rgb(54, 162, 235)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgb(54, 162, 235)'
                        }]
                    },
                    options: {
                        // Removido maintainAspectRatio para permitir o tamanho fixo
                        maintainAspectRatio: false,
                        elements: {
                            line: {
                                borderWidth: 3
                            }
                        },
                        scales: {
                            r: {
                                angleLines: {
                                    display: false
                                },
                                suggestedMin: 0,
                                suggestedMax: 100,
                                // --- ALTERAÇÃO AQUI ---
                                // Aumenta o tamanho da fonte dos perfis (Águia, Gato, etc.)
                                pointLabels: {
                                    font: {
                                        size: 14
                                    }
                                }
                            }
                        },
                        // --- ALTERAÇÃO AQUI ---
                        // Aumenta o tamanho da fonte da legenda (Percentual de Perfil)
                        plugins: {
                            legend: {
                                labels: {
                                    font: {
                                        size: 16
                                    }
                                }
                            }
                        }
                    }
                });
            }
        });
    </script>
{% endblock %}
